---
id: 0005
title: Create RAG Chatbot Plan
stage: plan
date: 2025-12-10
surface: agent
model: Claude Sonnet 4.5
feature: rag-chatbot
branch: 1-rag-chatbot
user: Fozia
command: /sp.plan
labels:
  - rag
  - chatbot
  - plan
  - openai-agent-sdk
  - qdrant
  - docusaurus
links:
  SPEC: "specs/rag_architect/spec.md"
  PLAN: "specs/rag_architect/plan.md"
  TICKET: null
  ADR: null
  PR: null
files:
  - specs/rag_architect/plan.md
  - specs/rag_architect/research/fastapi.md
  - specs/rag_architect/research/openai-agent-sdk.md
  - specs/rag_architect/research/context7-mcp.md
  - specs/rag_architect/research/qdrant.md
  - specs/rag_architect/research/sqlalchemy.md
  - specs/rag_architect/research/react.md
  - specs/rag_architect/data-model.md
  - specs/rag_architect/quickstart.md
  - specs/rag_architect/contracts/chat-api.md
  - specs/rag_architect/contracts/admin-api.md
  - specs/rag_architect/checklists/quality.md
tests: []
---

# Create RAG Chatbot Plan

## User Input

```
### Phase 1: Backend Setup
create a backend folder
1. Initialize FastAPI project with proper structure
2. Set up environment variables (.env file):
   - OPENAI_API_KEY
   - QDRANT_URL
   - QDRANT_API_KEY
   - NEON_DATABASE_URL
3. Create database models using SQLAlchemy
4. Implement Qdrant client connection
5.create virtual environment

### Phase 2: Document Processing
1. Create script to parse Docusaurus markdown files
2. Implement chunking logic with metadata preservation
3. Build embedding generation pipeline
4. Create Qdrant collection and upload vectors
5. Add admin endpoint to trigger re-ingestion

### Phase 3: RAG Implementation
1. Implement vector similarity search function
2. Create prompt template for context-aware responses
3. Build OpenAI integration using ChatKit/Agents SDK
4. Implement source citation extraction
5. Add error handling and fallback responses

### Phase 4: Frontend Integration
1. Create React chatbot component
2. Implement text selection detection
3. Build chat UI with message history
4. Add API integration with fetch/axios
5. Implement source link generation
6. Add component to Docusaurus theme

### Phase 5: Testing & Optimization
1. Test query accuracy with various questions
2. Optimize chunk size and retrieval parameters
3. Implement rate limiting and caching
4. Add logging and monitoring
5. Performance testing

## API Request/Response Examples

### Chat Query
```json
POST /api/v1/chat/query
{
  "question": "What is RAG?",
  "session_id": "uuid-here"
}

Response:
{
  "answer": "RAG (Retrieval-Augmented Generation) is...",
  "sources": [
    {
      "chapter": "Chapter 1",
      "section": "Introduction to RAG",
      "url": "/docs/chapter-1/intro-rag"
    }
  ],
  "message_id": "uuid-here"
}
```

### Selection Query
```json
POST /api/v1/chat/query-selection
{
  "question": "Explain this in simpler terms",
  "selected_text": "Vector embeddings are numerical representations...",
  "page_url": "/docs/chapter-2/embeddings",
  "session_id": "uuid-here"
}
```

## Configuration Files Needed

### requirements.txt
```
fastapi==0.104.1
uvicorn[standard]==0.24.0
openai==1.3.0
qdrant-client==1.7.0
psycopg2-binary==2.9.9
sqlalchemy==2.0.23
python-dotenv==1.0.0
langchain==0.1.0
langchain-openai==0.0.2
pydantic==2.5.0
```

### .env.example
```
OPENAI_API_KEY=your_key_here
QDRANT_URL=your_qand_url
QDRANT_API_KEY=your_qand_key
NEON_DATABASE_URL=postgresql://...
CORS_ORIGINS=http://localhost:3000,https://yourdomain.com
```

## Docusaurus Integration

### Custom Theme Component Path
```
src/theme/Root.js - Wrap app with chat provider
src/components/ChatBot/index.jsx - Main chat component
src/components/ChatBot/styles.module.css - Styling
```

### Installation in Docusaurus
```javascript
// docusaurus.config.js
module.exports = {
  // ...
  scripts: [
    {
      src: '/chatbot-init.js',
      async: true,
    },
  ],
};
```

## Success Criteria
- ✅ Chat responds accurately based on book content
- ✅ Sources are correctly cited with clickable links
- ✅ Text selection feature works smoothly
- ✅ UI is responsive and matches site theme
- ✅ Backend handles errors gracefully
- ✅ Chat history persists within session
- ✅ Fast response times (<3 seconds)

## Deliverables
1. FastAPI backend code with documentation
2. React chatbot component
3. Database migration scripts
4. Document ingestion script
5. Deployment configuration files
6. README with setup instructions
7. API documentation (auto-generated by FastAPI)

## Notes
- Use async/await patterns for better performance
- Implement proper error logging
- Add CORS middleware for frontend integration
- Consider implementing rate limiting
- Cache frequently asked questions
- Monitor OpenAI API costs
```

## Response Summary

Created a comprehensive implementation plan for the RAG chatbot feature that integrates with a Docusaurus-based book website. The plan includes:

1. **Plan Document** (plan.md): Detailed technical approach with all required phases and technology context
2. **Research Artifacts**: Comprehensive research files for all key technologies:
   - FastAPI framework
   - OpenAI Agent SDK
   - context7 MCP server
   - Qdrant vector database
   - SQLAlchemy ORM
   - React frontend
3. **Data Model**: Complete entity relationship diagram and schema definitions
4. **Quickstart Guide**: Step-by-step setup instructions with code examples
5. **API Contracts**: Detailed contract documentation for chat and admin endpoints
6. **Quality Checklist**: Validation that all requirements are addressed

The plan specifically incorporates the requested technologies:
- OpenAI Agent SDK for creating intelligent agents
- context7 MCP server for accessing current documentation
- FastAPI backend with async capabilities
- Qdrant vector database for RAG operations
- React frontend for Docusaurus integration

All functional requirements from the specification are addressed in the implementation plan, with proper API contracts, data models, and architectural decisions documented.

## Outcome

Plan is complete and validated against the original specification. All requirements are addressed, technology choices are documented, and implementation phases are clearly defined. Ready for the task breakdown phase (/sp.tasks).